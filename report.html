<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Population dynamics in Saxon municipalities</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="report_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="report_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Population dynamics in Saxon municipalities</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="cell-output-display">
<div id="fig-pop-saxony" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="report_files/figure-html/fig-pop-saxony-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Population in Saxon municipalities in 2015</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pop-change" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="report_files/figure-html/fig-pop-change-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Population change in Saxon municipalities from 2015 to 2020</figcaption>
</figure>
</div>
</div>
</div>
<section id="data-description" class="level2">
<h2 class="anchored" data-anchor-id="data-description">Data description</h2>
<p>This analysis uses population data from the SEDAC Gridded Population of the World (GPW), v4 for the years 2015 and 2020 in the highest resolution (30 arc-second grid cells), which yields rasters that depict about 1 km of actual land space. These raster information are then compiled to Saxon municipality population counts and finally used to calculate the population growth rate over 5 years. In sum, there are 418 observed municipalities.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">&nbsp;Variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pop_growth</td>
<td style="text-align: left;">log(pop_2020/pop_2015)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pop_2015</td>
<td style="text-align: left;">log(pop_2015</td>
</tr>
<tr class="odd">
<td style="text-align: left;">unemployed</td>
<td style="text-align: left;">log(number of unemployed in 2015)</td>
</tr>
<tr class="even">
<td style="text-align: left;">purchasing_power</td>
<td style="text-align: left;">log(available income per capita in 2015 in Euro)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distance_supermarkets</td>
<td style="text-align: left;">log(average distance to the next supermarket)</td>
</tr>
<tr class="even">
<td style="text-align: left;">distance_pharmacy</td>
<td style="text-align: left;">log(average distance to the next pharmacy)</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">SD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pop_growth</td>
<td style="text-align: right;">-0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">-0.08</td>
<td style="text-align: right;">-0.07</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">▂▇▃▁▁ ▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">pop_2015_log</td>
<td style="text-align: right;">8.41</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">5.85</td>
<td style="text-align: right;">8.33</td>
<td style="text-align: right;">13.14</td>
<td style="text-align: right;">▂▅▇▄▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">unemployed_log</td>
<td style="text-align: right;">4.96</td>
<td style="text-align: right;">1.17</td>
<td style="text-align: right;">2.64</td>
<td style="text-align: right;">4.79</td>
<td style="text-align: right;">10.21</td>
<td style="text-align: right;">▂▄▇▅▃▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">purchasing_power</td>
<td style="text-align: right;">19579.45</td>
<td style="text-align: right;">1187.44</td>
<td style="text-align: right;">16399.00</td>
<td style="text-align: right;">19474.00</td>
<td style="text-align: right;">24585.00</td>
<td style="text-align: right;">▁▄▇▅▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distance_supermarkets</td>
<td style="text-align: right;">1966.33</td>
<td style="text-align: right;">1333.29</td>
<td style="text-align: right;">299.00</td>
<td style="text-align: right;">1555.00</td>
<td style="text-align: right;">7136.00</td>
<td style="text-align: right;">▇▆▄▃▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">distance_pharmacy</td>
<td style="text-align: right;">2755.89</td>
<td style="text-align: right;">1867.03</td>
<td style="text-align: right;">423.00</td>
<td style="text-align: right;">2046.00</td>
<td style="text-align: right;">10023.00</td>
<td style="text-align: right;">▇▆▃▃▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reachability_middle_city</td>
<td style="text-align: right;">11.02</td>
<td style="text-align: right;">6.69</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">11.12</td>
<td style="text-align: right;">36.07</td>
<td style="text-align: right;">▄▄▇▆▅▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">reachability_metropolitan</td>
<td style="text-align: right;">28.31</td>
<td style="text-align: right;">12.98</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">26.01</td>
<td style="text-align: right;">68.93</td>
<td style="text-align: right;">▁▂▇▇▅▄▂▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">settlement_space_share</td>
<td style="text-align: right;">12.95</td>
<td style="text-align: right;">7.65</td>
<td style="text-align: right;">4.04</td>
<td style="text-align: right;">10.70</td>
<td style="text-align: right;">53.55</td>
<td style="text-align: right;">▇▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">recreations_space_share</td>
<td style="text-align: right;">1.28</td>
<td style="text-align: right;">1.53</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.77</td>
<td style="text-align: right;">17.04</td>
<td style="text-align: right;">▇▁</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The population information are then joined by municipality-specific information from the INKAR portal of the German Federal Office for Building and Regional Planning (BBR). Following <span class="citation" data-cites="alamá-sabater2021">(<a href="#ref-alamá-sabater2021" role="doc-biblioref">Alamá-Sabater et al. 2021</a>)</span>, the explanatory variables cover economic conditions, accessibility, public facilities, and natural amenities. Economic conditions are measured by the unemployment rate and purchasing power per capita. Accessibility is defined as the distance to the nearest middle or large center, according to the Central Place theory as applied in Germany. Public facilities are measured by the average distance to the next supermarket and to the next pharmacy. The space share reserved for settlement (e.g.&nbsp;buildings, roads) and recreation (mostly green areas) serve as proxies for natural amenities.</p>
</section>
<section id="setting-and-empirical-strategy" class="level2">
<h2 class="anchored" data-anchor-id="setting-and-empirical-strategy">Setting and Empirical Strategy</h2>
<p>I examine the German federal state Saxony, where most of the regions are expected to lose population over the coming decades <span class="citation" data-cites="maretzke2024">(<a href="#ref-maretzke2024" role="doc-biblioref">Maretzke, Hoymann, and Schlömer 2024</a>)</span>. But as shown in Figure 2, there is spatial heterogeneity in population change rates. In the following analysis, I will shed light on the effect of economic conditions, accessibility, public facilities, and natural amenities on population change trajectories. For this, I propose a simple growth model based on that of <span class="citation" data-cites="alamá-sabater2021">(<a href="#ref-alamá-sabater2021" role="doc-biblioref">Alamá-Sabater et al. 2021</a>)</span>:</p>
<p><span class="math display">\[
popgrowth_i = \beta_0 + \beta_1pop2015_i + \beta_2unemployed_i + \beta_4purchasingpower_i
\]</span> <span class="math display">\[
+ \beta_5distancesupermarkets_i + \beta_6distancepharmacy_i + \beta_7distancemiddlecity_i
\]</span> <span class="math display">\[
+ \beta_8recreations_i + u_i
\]</span></p>
<p>Derived from economic intuition, I expect the following directions of impact: As people tend to shift from worse to better labour market conditions, the effect of rising unemployment should be negative. At the same, higher income regions attract more workers, so that purchasing power should rise population growth. Easy access to public facilities elevates quality of life, therefore lower average distance to supermarkets and pharmacies should attract more residents. The same applies to distance to urban clusters (access to agglomerations, for example in social institutions or culture) and the share of recreational area.</p>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>Specification 1 in the table shows the baseline results for the model proposed above calculated by simple OLS with standard errors clustered at the Kreis (county) level. Specification 2 switches then to Conley standard errors using the conleyreg-package. In that case, unemployment shows a small significant coefficient, while purchasing power has a huge positive effect. The effects of the distance to the next middle center and of the share of recreational space is positive, but very small. The effect of public facilities is small and insignificant. Specification 3 then turns to some more specific alternative measures offered by the INKAR database, where <span class="math inline">\(log(purchasingpowerretail)\)</span> is the available income for retail spending, <span class="math inline">\(reachabilitymetropolitan\)</span> the distance to the next metropolitan center, and <span class="math inline">\(settlementspaceshare\)</span> the area share of settlement and traffic use. The measures for purchasing power and space use share render insignificant, while the effect of distance to centers shrinks even smaller. Interestingly, in this specification the effect of unemployment rises. In all three specifications the effect of incumbent residents shows a positive effect.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(2)</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;&nbsp;(3)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pop_2015_log</td>
<td style="text-align: center;">0.013+</td>
<td style="text-align: center;">0.013***</td>
<td style="text-align: center;">0.021***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.006)</td>
<td style="text-align: center;">(0.003)</td>
<td style="text-align: center;">(0.003)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">unemployed_log</td>
<td style="text-align: center;">-0.005</td>
<td style="text-align: center;">-0.005*</td>
<td style="text-align: center;">-0.012***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.004)</td>
<td style="text-align: center;">(0.002)</td>
<td style="text-align: center;">(0.002)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(purchasing_power)</td>
<td style="text-align: center;">0.081*</td>
<td style="text-align: center;">0.081***</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.036)</td>
<td style="text-align: center;">(0.019)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(purchasing_power_retail)</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.017</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.016)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distance_supermarkets</td>
<td style="text-align: center;">0.001</td>
<td style="text-align: center;">0.001+</td>
<td style="text-align: center;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.001)</td>
<td style="text-align: center;">(0.001)</td>
<td style="text-align: center;">(0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distance_pharmacy</td>
<td style="text-align: center;">0.000</td>
<td style="text-align: center;">0.000</td>
<td style="text-align: center;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.000)</td>
<td style="text-align: center;">(0.000)</td>
<td style="text-align: center;">(0.000)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">reachability_middle_city</td>
<td style="text-align: center;">0.001*</td>
<td style="text-align: center;">0.001***</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.000)</td>
<td style="text-align: center;">(0.000)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">reachability_metropolitan</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.000***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.000)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">recreations_space_share</td>
<td style="text-align: center;">0.002</td>
<td style="text-align: center;">0.002*</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.002)</td>
<td style="text-align: center;">(0.001)</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">settlement_space_share</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">0.000</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">(0.000)</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> + p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>I have shown that municipalities with already high levels of population count grow faster than cities with fewer inhabitants. This could catch agglomeration effects, such as social and cultural. There is also a negative effect of higher unemployment and a positive effect of purchasing power, which sheds light on the importance of labour market conditions. The distance to public facilities like supermarkets and pharmacies, and to middle and large centers has no significant effect, which could be explained by already sufficient coverage and accessibility across the state, but perhaps there are other public facilities that are more unevenly distributed or the residents are more responsive to the heterogeneous distances. Further inquiry could incorporate spatial autocorrelation, more accurate measures of public facilities and more granular data, as many rural municipalities have much heterogeneity in themselves, as they typically consist of a core town and multiple villages around. A heavy barrier in this analysis was data availability, as many data series only begin after 2010.</p>
</section>
<section id="references" class="level2 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-alamá-sabater2021" class="csl-entry" role="listitem">
Alamá-Sabater, L., V. Budí, N. Roig-Tierno, and J. M. García-Álvarez-Coque. 2021. <span>“Drivers of Depopulation and Spatial Interdependence in a Regional Context.”</span> <em>Cities</em> 114 (July): 103217. <a href="https://doi.org/10.1016/j.cities.2021.103217">https://doi.org/10.1016/j.cities.2021.103217</a>.
</div>
<div id="ref-maretzke2024" class="csl-entry" role="listitem">
Maretzke, Steffen, Jana Hoymann, and Claus Schlömer. 2024. <em>Raumordnungsprognose 2045: Bevölkerungsprognose</em>. BBSR-Analysen kompakt 2024, 04. Bonn: Bundesinstitut für Bau-, Stadt- und Raumforschung (BBSR) im Bundesamt für Bauwesen und Raumordnung (BBR).
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>